<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SWGBuddy</title>
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/resources.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
	<header class="main-header">
		<div class="logo"><span>SWG</span>BUDDY</div>
		<nav class="top-nav">
			<button class="nav-btn active" data-target="resources-container">RESOURCES</button>
			<button class="nav-btn" data-target="schematics-container">SCHEMATICS</button>
		</nav>
		<div class="controls-section">
			<div class="server-select-container">
				<label for="server-select"><i class="fa-solid fa-server"></i></label>
				<select id="server-select">
					<option value="cuemu" selected>CUEmu</option>
					</select>
			</div>

			<div id="auth-section" class="auth-section">
				<a href="/login" class="btn-discord">
					<i class="fa-brands fa-discord"></i> Login
				</a>
			</div>
		</div>
	</header>
    <div class="app-container">
		<main id="main-content">
			<section id="resources-container" class="page-container active">
				<div class="resource-filters-row">
					<div class="custom-dropdown" id="taxonomy-dropdown">
                        <div class="dropdown-selected" onclick="toggleDropdown()">All Resources</div>
                        <div class="dropdown-list" id="taxonomy-list">
                            <div class="dropdown-item root-item" data-id="" data-label="" onclick="selectCategory(1, 'Resources', 'All Resources')">All Resources</div>
                        </div>
                    </div>
                    <input type="text" placeholder="Search resources..." class="search-input">
					<button class="add-resource-btn" onclick="openAddResourceModal()">Add Resource</button>
					<div class="pagination-stack">
						<div class="pagination-controls">
							<label for="results-per-page">Show Results:</label>
							<select id="results-per-page" class="results-select" onchange="changeResultsPerPage()">
								<option value="10">10</option>
								<option value="25">25</option>
								<option value="50" selected>50</option>
								<option value="100">100</option>
							</select>
						</div>

						<div id="page-nav-container" class="page-nav-container">
							<button id="btn-first" class="page-nav-btn" onclick="goToPage('first')">«</button>
							<button id="btn-prev" class="page-nav-btn" onclick="goToPage('prev')">‹</button>
							
							<select id="page-select" class="results-select" onchange="goToPage(this.value)">
								</select>
							
							<button id="btn-next" class="page-nav-btn" onclick="goToPage('next')">›</button>
							<button id="btn-last" class="page-nav-btn" onclick="goToPage('last')">»</button>
						</div>
					</div>
				</div>
				<table class="resource-table">
					<thead>
						<tr>
							<th class="col-name" onclick="toggleSort('name')"><div class="sort-wrapper left"><span>NAME </span><div class="sort-btns"><span class="up">▲</span><span class="down">▼</span></div></div></th>
							<th class="col-type" onclick="toggleSort('type')"><div class="sort-wrapper left"><span>TYPE </span><div class="sort-btns"><span class="up">▲</span><span class="down">▼</span></div></div></th>
							<th class="col-stat" onclick="toggleSort('res_weight_rating')"><div class="sort-wrapper center"><span></span>Rating</span><div class="sort-btns"><span class="up">▲</span><span class="down">▼</span></div></div></th>
							<th class="col-stat" onclick="toggleSort('res_oq')"><div class="sort-wrapper center"><span>OQ</span><div class="sort-btns"><span class="up">▲</span><span class="down">▼</span></div></div></th>
							<th class="col-stat" onclick="toggleSort('res_cr')"><div class="sort-wrapper center"><span>CR</span><div class="sort-btns"><span class="up">▲</span><span class="down">▼</span></div></div></th>
							<th class="col-stat" onclick="toggleSort('res_cd')"><div class="sort-wrapper center"><span>CD</span><div class="sort-btns"><span class="up">▲</span><span class="down">▼</span></div></div></th>
							<th class="col-stat" onclick="toggleSort('res_dr')"><div class="sort-wrapper center"><span>DR</span><div class="sort-btns"><span class="up">▲</span><span class="down">▼</span></div></div></th>
							<th class="col-stat" onclick="toggleSort('res_fl')"><div class="sort-wrapper center"><span>FL</span><div class="sort-btns"><span class="up">▲</span><span class="down">▼</span></div></div></th>
							<th class="col-stat" onclick="toggleSort('res_hr')"><div class="sort-wrapper center"><span>HR</span><div class="sort-btns"><span class="up">▲</span><span class="down">▼</span></div></div></th>
							<th class="col-stat" onclick="toggleSort('res_ma')"><div class="sort-wrapper center"><span>MA</span><div class="sort-btns"><span class="up">▲</span><span class="down">▼</span></div></div></th>
							<th class="col-stat" onclick="toggleSort('res_pe')"><div class="sort-wrapper center"><span>PE</span><div class="sort-btns"><span class="up">▲</span><span class="down">▼</span></div></div></th>
							<th class="col-stat" onclick="toggleSort('res_sr')"><div class="sort-wrapper center"><span>SR</span><div class="sort-btns"><span class="up">▲</span><span class="down">▼</span></div></div></th>
							<th class="col-stat" onclick="toggleSort('res_ut')"><div class="sort-wrapper center"><span>UT</span><div class="sort-btns"><span class="up">▲</span><span class="down">▼</span></div></div></th>
							<th class="col-loc">LOCATION</th>
							<th class="col-date" onclick="toggleSort('date_reported')"><div class="sort-wrapper center"><span>DATE</span><div class="sort-btns"><span class="up">▲</span><span class="down">▼</span></div></div></th>
							<th class="col-status" onclick="toggleSort('is_active')"><div class="sort-wrapper center"><span>STATUS</span><div class="sort-btns"><span class="up">▲</span><span class="down">▼</span></div></div></th>
						</tr>
					</thead>
					<tbody id="resource-log-body"></tbody>
				</table>
			</section>
			<div id="resource-modal" class="modal-overlay" onclick="closeModal(event)">
				<div class="modal-content" onclick="event.stopPropagation()">
					<div class="modal-header">
						<h2 id="modal-title">Resource Details</h2>
						<button class="close-btn" onclick="closeModal()">×</button>
					</div>
					<div id="modal-body" class="modal-body-grid"></div>
					
					<div id="modal-status-bar" class="status-bar"></div>
					
					<div class="modal-action-bar">
						<button id="btn-edit" onclick="enterEditMode()">Edit Values</button>
						<button id="btn-save" onclick="saveResourceEdits()" disabled>Save</button>
						<button id="btn-cancel" onclick="cancelEditMode()" disabled>Cancel</button>
					</div>
				</div>
			</div>

			<section id="schematics-container" class="page-container">
				<div class="placeholder-msg">Schematics functionality coming soon...</div>
			</section>
		</main>
    </div>
<script src="{{ url_for('static', filename='js/config.js') }}"></script>
<script src="{{ url_for('static', filename='js/api.js') }}"></script>
<script src="{{ url_for('static', filename='js/taxonomy.js') }}"></script>
<script src="{{ url_for('static', filename='js/modal.js') }}"></script>
<script src="{{ url_for('static', filename='js/table.js') }}"></script>
<script src="{{ url_for('static', filename='js/filters.js') }}"></script>
<script src="{{ url_for('static', filename='js/resources.js') }}"></script>
<script src="{{ url_for('static', filename='js/app.js') }}"></script>

<script>
    // Main Entry Point
    document.addEventListener('DOMContentLoaded', async () => {
        // 1. Initialize SPA Tab Logic and Listeners
        initTabs(); 
        initListeners();
        // 2. Fetch Data from API
        // Promise.all ensures both load before we trigger initial filters
        await Promise.all([
            loadResources(),
            loadTaxonomy()
        ]);
        
		updateSortVisuals();
        // 3. Set initial UI state
        console.log("Resource Tracker Initialized");
    });
</script>
</body>
</html>